(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{1125:function(e,t,r){e.exports={search:"search_2zBrB"}},1266:function(e,t,r){},1366:function(e,t,r){"use strict";r(1266)},1367:function(e,t,r){"use strict";var n=r(1125),o=r.n(n);r.d(t,"default",(function(){return o.a}))},1439:function(e,t,r){"use strict";r.r(t);r(31),r(20),r(22),r(34),r(35);var n=r(12),o=r(7),c=(r(57),r(30),r(26)),l=r.n(c),m=r(14),f=r(944),h=(r(890),r(38),r(147),r(925)),d=r(343),v=r(950),y=r(83);function w(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function O(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?w(Object(source),!0).forEach((function(t){Object(n.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):w(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var _={components:{DefaultAvatar:d.a},mixins:[Object(v.a)((function(){return{type:"branch",input:""}}))],props:{repository:{type:Object,required:!0}},data:function(){return{processing:!1,configType:"write",show:!1,isActive:!1,rules:{type:"required",input:"required"}}},computed:O(O({},Object(m.d)("auth",["workspaces"])),{},{githubAppLink:function(){var e=this.repository,t=e.scm,r=e.namespace,n=e.installation_id;return"Organization"===this.workspaces.find((function(e){return e.scm===t&&e.name===r})).type?"https://github.com/organizations/".concat(r,"/settings/installations/").concat(n):"https://github.com/settings/installations/".concat(n)},repoPage:function(){var e=this.repository,t=e.scm,r=e.namespace,n=e.name;return"/".concat(t,"/").concat(r,"/").concat(n)},switchTooltip:function(){return this.activeSubscription(this.repository)?this.repository.is_enabled?"Disable CI":"Enable CI":"An active subscription for the namespace is required for enabling projects"},nameComponent:function(){return this.repository.is_enabled?{component:"nuxt-link",props:{to:this.repoPage}}:{component:"span",props:{}}},hasActiveSubscription:function(){return this.activeSubscription(this.repository)}}),methods:O(O({},Object(m.b)("user_repositories",["enableCI","disableCI"])),{},{activeSubscription:function(e){return!!e.subscription&&(!e.subscription.expires_at||this.$options.filters.formatDate(e.subscription.expires_at,"yyyy-MM-dd HH:mm")>Object(h.a)(new Date,"yyyy-MM-dd HH:mm"))},toggleCI:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e?t.enable:t.disable,r.prev=1,t.processing=!0,r.next=5,n();case 5:e&&t.open(),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(1),"cancel"!==r.t0&&"close"!==r.t0&&(r.t0.response&&[401,403].includes(r.t0.response.status)||r.t0.response?t.$message.error("".concat(r.t0.response.data.message)):t.$message.error("Something went wrong, please try again later"));case 11:return r.prev=11,t.processing=!1,r.finish(11);case 14:case"end":return r.stop()}}),r,null,[[1,8,11,14]])})))()},enable:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.enableCI(e.repository);case 2:case"end":return t.stop()}}),t)})))()},disable:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r="Do you really want to disable CI for <b>".concat(e.repository.namespace,"/").concat(e.repository.name,"</b>?"),t.next=3,e.$confirm(r,"Disable CI?",{dangerouslyUseHTMLString:!0});case 3:return t.next=5,e.disableCI(e.repository);case 5:case"end":return t.stop()}}),t)})))()},submit:function(){var e=this.repository,t=e.scm,r=e.namespace,n=e.name;"trigger"===this.configType?this.triggerBuild():this.$router.push("/".concat(t,"/").concat(r,"/").concat(n,"/config"))},triggerBuild:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.processing=!0,r=e.repository,o=r.scm,c=r.namespace,l=r.name,t.prev=2,t.next=5,Object(y.u)(o,c,l,Object(n.a)({},e.form.type,e.form.input.trim()));case 5:e.$message.success("If you have a payload for that ".concat(e.form.type,", your custom build will be scheduled soon.")),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),"cancel"!==t.t0&&(422===t.t0.response.status?e.$message.error("Can not find any commit for that ".concat(e.form.type)):404===t.t0.response.status?e.$message.error(t.t0.response.data.message):401===t.t0.response.status?e.$message.error("".concat(t.t0.response.data.message,", you need to re-login again to update new credential")):409===t.t0.response.status?e.$message.error("Repository is empty"):e.$message.error("Something went wrong, please try again later"));case 11:return t.prev=11,e.processing=!1,e.show=!1,t.next=16,e.$router.push("/".concat(o,"/").concat(c,"/").concat(l));case 16:return t.finish(11);case 17:case"end":return t.stop()}}),t,null,[[2,8,11,17]])})))()},open:function(){this.show=!0,this.form.input="branch"===this.form.type?this.repository.default_branch:""},close:function(){this.show=!1,this.resetForm(this.$refs.form)},toggle:function(){this.isActive=!this.isActive}})},x=(r(1366),r(6)),j={components:{Item:Object(x.a)(_,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("li",{staticClass:"user-repository-list__item"},[r("div",{staticClass:"flex flex-1 items-center"},[r("DefaultAvatar",{staticClass:"mr-4",attrs:{name:e.repository.name}}),e._v(" "),e.repository.is_enabled?r("nuxt-link",{attrs:{to:"/"+e.repository.scm+"/"+e.repository.namespace+"/"+e.repository.name}},[r(e.nameComponent.component,e._b({tag:"component"},"component",e.nameComponent.props,!1),[r("span",[e._v(e._s(e.repository.namespace))]),e._v(" "),r("span",{staticClass:"mx-1"},[e._v("/")]),e._v(" "),r("b",[e._v(e._s(e.repository.name))])])],1):r(e.nameComponent.component,e._b({tag:"component"},"component",e.nameComponent.props,!1),[r("span",[e._v(e._s(e.repository.namespace))]),e._v(" "),r("span",{staticClass:"mx-1"},[e._v("/")]),e._v(" "),r("b",[e._v(e._s(e.repository.name))])]),e._v(" "),e.repository.is_private?r("i",{directives:[{name:"tooltip",rawName:"v-tooltip"}],staticClass:"el-icon-lock text-gray-600 ml-2",attrs:{title:"Private repository"}}):e._e()],1),e._v(" "),e.repository.permission.admin?[e.processing?r("i",{staticClass:"el-icon-loading mr-2 text-gray-600"}):e._e(),e._v(" "),e.repository.is_enabled&&"App\\Models\\GithubAppInstallation"===e.repository.access_token_owner_type?r("a",{attrs:{href:e.githubAppLink}},[r("small",{staticClass:"text-gray-600 hover:text-blue-700"},[e._v("\n                You must go to GithubApp to disable this repository\n            ")])]):r("ElSwitch",{directives:[{name:"tooltip",rawName:"v-tooltip"}],attrs:{value:e.repository.is_enabled,title:e.switchTooltip,disabled:e.processing||!e.hasActiveSubscription},on:{change:e.toggleCI}}),e._v(" "),r("ElDialog",{attrs:{visible:e.show,width:"25%"},on:{"update:visible":function(t){e.show=t},open:e.open,close:e.close}},[r("div",{attrs:{slot:"title"},slot:"title"},[r("span",{staticClass:"font-bold text-2xl"},[e._v("Select a config file for "+e._s(e.repository.name))])]),e._v(" "),r("ElRadioGroup",{on:{change:function(t){e.configType=t}},model:{value:e.configType,callback:function(t){e.configType=t},expression:"configType"}},[r("ElRadio",{staticClass:"py-3 flex whitespace-normal break-normal",attrs:{label:"write"},on:{change:e.toggle}},[r("span",{staticClass:"w-full"},[e._v("\n                        Write config using our\n                        "),r("span",{staticClass:"font-mono text-xs rounded px-1 mx-1 bg-gray-300"},[e._v("\n                            .sun-ci.yml\n                        ")]),e._v("\n                        template\n                    ")])]),e._v(" "),r("ElRadio",{staticClass:"py-3 flex whitespace-normal break-normal",attrs:{label:"trigger"},on:{change:e.toggle}},[r("div",{staticClass:"w-full"},[r("p",[e._v("\n                            If you already have\n                            "),r("span",{staticClass:"font-mono text-xs rounded px-1 mx-1 bg-gray-300"},[e._v("\n                                .sun-ci.yml\n                            ")]),e._v("\n                            in your repo.\n                        ")]),e._v(" "),r("p",[e._v("Select the branch/tag it's on to create a build from your config")])]),e._v(" "),r("ElForm",{ref:"form",staticClass:"mt-2",attrs:{model:e.form,rules:e.rules}},[r("ElFormItem",[r("ElInput",{attrs:{placeholder:"Enter "+e.form.type,disabled:!e.isActive,name:"value"},model:{value:e.form.input,callback:function(t){e.$set(e.form,"input",t)},expression:"form.input"}},[r("ElSelect",{staticClass:"w-28",attrs:{slot:"prepend",name:"type"},on:{change:e.open},slot:"prepend",model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(["Branch","Tag"],(function(e){return r("ElOption",{key:e,attrs:{label:e,value:e.toLowerCase()}})})),1)],1)],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"text-right"},[r("ElButton",{attrs:{loading:e.processing,type:"primary"},on:{click:e.submit}},[e._v("\n                    Let's Go\n                ")])],1)],1)]:[e._m(0)]],2)}),[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("small",{staticClass:"text-gray-600"},[r("i",{staticClass:"el-icon-lock"}),e._v("\n            Contact repository admin to setup CI\n        ")])}],!1,null,null,null).exports},props:{repositories:{required:!0,type:Array}}},$=Object(x.a)(j,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ul",{staticClass:"user-repository-list rounded overflow-hidden"},e._l(e.repositories,(function(e){return r("Item",{key:e.id,attrs:{repository:e}})})),1)}),[],!1,null,null,null).exports,k=(r(177),{mixins:[r(954).a],props:{workspaces:{type:Array,default:function(){return[]}}},data:function(){var e=this.$route.query;return{namespace:e.namespace,search:e.search}},computed:{workspacesByScm:function(){var e=this;return this.workspaces.filter((function(t){return t.scm===e.$route.params.scm}))}}}),C=r(1367);var E=Object(x.a)(k,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"flex align-center"},[r("ElInput",{class:e.$style.search,attrs:{size:"medium",placeholder:"Filter by name","suffix-icon":"el-icon-search",clearable:""},on:{clear:function(t){return e.filter("search")}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.filter("search")}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}},[r("ElSelect",{staticClass:"w-60",class:e.$style.orgs,attrs:{slot:"prepend",size:"medium",placeholder:"All Organizations",clearable:"",filterable:""},on:{change:function(t){return e.filter("namespace")}},slot:"prepend",model:{value:e.namespace,callback:function(t){e.namespace=t},expression:"namespace"}},e._l(e.workspacesByScm,(function(e,t){var n=e.name;return r("ElOption",{key:t,attrs:{value:n}})})),1)],1)],1)}),[],!1,(function(e){this.$style=C.default.locals||C.default}),null,null).exports,P=r(991),S=r(59),A=r(951);function R(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function D(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?R(Object(source),!0).forEach((function(t){Object(n.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):R(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var I={name:"UserRepositories",components:{ListFilter:E,List:$,Pagination:f.a,Alert:P.a},inject:["setLinks"],layout:"none_sidebar",validate:function(e){var t=e.params;return Object(A.a)(t.scm)},asyncData:function(){return Object(o.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(S.d)().then((function(e){return e.data}));case 2:return t=e.sent,e.abrupt("return",{connectedAccounts:t.data});case 4:case"end":return e.stop()}}),e)})))()},data:function(){return{title:"Repositories",syncing:!1}},fetch:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){var r,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.store,n=e.query,o=e.params,n.scm=o.scm,r.dispatch("user_repositories/get",D(D({},n),{},{limit:15}));case 3:case"end":return t.stop()}}),t)})))()},head:function(){return{title:this.title}},computed:D(D(D({},Object(m.d)("user_repositories",["repositories","pagination"])),Object(m.d)("auth",["workspaces"])),{},{links:function(){return[{text:"Add Repository",to:this.$route.query.path}]}}),watchQuery:!0,created:function(){this.setLinks(this.links)},mounted:function(){var e=this,t=l()(this.connectedAccounts,(function(t){return t.provider===e.$route.params.scm}));t&&!t.last_sync_at&&this.sync(),this.$gtag.pageview({page_title:this.title,page_path:this.$route.path,page_location:window.location.href})},methods:{sync:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.syncing=!0,t.next=4,e.$store.dispatch("user_repositories/sync",e.$route.params.scm);case 4:return t.next=6,e.$store.dispatch("user_repositories/get",e.$route.query);case 6:e.$message.success("".concat(e.$route.params.scm.charAt(0).toUpperCase()+e.$route.params.scm.slice(1)," account synced")),e.$nuxt.$loading.start(),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),t.t0.response&&401===t.t0.response.status?e.$message.error("".concat(t.t0.response.data.message,", you need to re-login again to update new credential")):e.$message.error("Something went wrong, please try again later");case 13:return t.prev=13,e.$nuxt.$loading.finish(),e.syncing=!1,t.finish(13);case 17:case"end":return t.stop()}}),t,null,[[0,10,13,17]])})))()}}},L=Object(x.a)(I,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"user-repositories my-6 mx-10"},[r("div",{staticClass:"flex align-center justify-between mt-8 mb-4"},[r("ListFilter",{staticClass:"flex-1",attrs:{workspaces:e.workspaces}}),e._v(" "),r("ElButton",{attrs:{loading:e.syncing,icon:"el-icon-refresh"},on:{click:e.sync}},[e._v("\n            Sync Account\n        ")])],1),e._v(" "),e.repositories.length?r("div",[r("List",{attrs:{repositories:e.repositories}}),e._v(" "),r("Pagination",{attrs:{data:e.pagination}})],1):r("div",[r("Alert",{attrs:{title:"You are not member of any organizations or repositories!"}},[r("nuxt-link",{attrs:{to:"/accounts/manage"}},[r("span",[e._v("Go to account management page.")])])],1)],1)])}),[],!1,null,null,null);t.default=L.exports},944:function(e,t,r){"use strict";var n=r(12),o=r(564),c=r.n(o),l=r(873),m=r.n(l),f={props:{data:{type:Object,required:!0},pageParam:{type:String,default:"page"},hashParam:{type:String,default:null}},methods:{go:function(e){this.$router.push(this.to(e))},to:function(e){var t,path=this.$route.path,r=null!==(t=this.hashParam)&&void 0!==t?t:this.$route.hash,o=c()(this.$route.query,[this.pageParam]);return{path:path,query:1!==e?m()({},o,Object(n.a)({},this.pageParam,e)):o,hash:r}}}},h=r(6),component=Object(h.a)(f,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("ElPagination",{staticClass:"text-center my-4",attrs:{"current-page":e.data.current_page,"page-count":e.data.last_page,layout:"prev, pager, next",background:"","hide-on-single-page":""},on:{"current-change":e.go}})}),[],!1,null,null,null);t.a=component.exports},950:function(e,t,r){"use strict";var n=r(566),o=r.n(n),c=r(953);t.a=function(e){return{mixins:[c.a],data:function(){return{show:!1,editing:null,form:e()}},watch:{editing:function(t){this.form=t?o()(t):e()}},methods:{open:function(e){this.editing=e,this.show=!0},close:function(){this.show=!1},clear:function(form){var t=this;this.editing=null,this.form=e(),this.$nextTick((function(){t.clearError(form)}))}}}}},951:function(e,t,r){"use strict";function n(e){return/(^(?!:\/\/)(?=.{1,255}$)((.{1,63}\.){1,127}(?![0-9]*$)[a-z0-9-]+\.?)$)|^github$|^gitlab$|^bitbucket$/i.test(e)}r.d(t,"a",(function(){return n}))},953:function(e,t,r){"use strict";var n=r(7),o=r(12),c=r(45),l=r(337),m=r(339),f=r(176),h=r(338);r(30),r(146),r(175),r(174),r(565),r(22),r(73),r(57),r(31),r(20),r(34),r(35);var d=r(23),v=r.n(d),y=r(875),w=r.n(y),O=r(145),_=r.n(O),x=r(877),j=r.n(x),$=r(878),k=r.n($),C=r(879),E=r.n(C);function P(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function S(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?P(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):P(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var A={required:"{field} is required",type:"{field} must be a valid {value}",pattern:"{field} must match the pattern {value}",min:"{field} must be at least {value} charaters",max:"{field} must not be longer than {value} characters",length:"{field} must be {value} characters",enum:"{field} must be a value in {value}"};function R(e){if("string"!=typeof e)return e;if("true"===e)return!0;if("false"===e)return!1;if(/,/.test(e))return e.split(",");var t=Number(e);return Number.isNaN(t)?e:t}function D(e){if(!1!==e){if(!e.response)throw e;var t;419===e.response.status?this.$message.error("Your session has expired, try reloading the page"):422===e.response.status?this.serverErrors=(t=e.response.data.errors,w()(t,"0")):e.response.data.message?this.$message.error(e.response.data.message):this.$message.error("Something went wrong, please try again later")}}t.a={data:function(){return{processing:!1,serverErrors:{},rules:[]}},computed:{formRules:function(){return w()(this.rules,(function(e,t){if("string"!=typeof e)return e;var r=t;return e.split("|").map((function(e){var t,n,d=e.split(";"),y=(n=d,Object(l.a)(n)||Object(m.a)(n)||Object(f.a)(n)||Object(h.a)()),main=y[0],w=y.slice(1),O=main.split(":"),x=Object(c.a)(O,2),$=x[0],C=x[1],P=R(void 0===C||C);if("name"===$)return r=P,null;var D=w.reduce((function(e,t){var r=t.split(":"),n=Object(c.a)(r,2),l=n[0],m=n[1];return S(S({},e),{},Object(o.a)({},l,R(m)))}),{});return S((t={},Object(o.a)(t,$,P),Object(o.a)(t,"message",function(e,t){var r=t.field,n=t.value,o=v()(A,e).replace("{field}",r).replace("{value}",n);return _()(j.a,k.a,E.a)(o)}($,{field:r,value:P,extras:D})),t),D)})).filter(Boolean)}))}},methods:{submit:function(form,e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.serverErrors={},r.prev=1,t.processing=!0,!form.model){r.next=6;break}return r.next=6,form.validate();case 6:return r.next=8,e(form.model);case 8:n=r.sent,t.$emit("saved",n?n.data:null),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(1),D.call(t,r.t0);case 15:return r.prev=15,t.processing=!1,r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[1,12,15,18]])})))()},clearError:function(form){form&&form.clearValidate(),this.serverErrors={}},resetForm:function(form){form&&form.resetFields()}}}},954:function(e,t,r){"use strict";var n=r(145),o=r.n(n),c=r(874),l=r.n(c),m=r(876),f=r.n(m);t.a={methods:{filter:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"page",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this[e],path=this.$route.path,c=null!=r?r:this.$route.hash,m=n?f()(e,n):l()(e),h=o()(m,l()(t))(this.$route.query);this.$router.push({path:path,query:h,hash:c})}}}},991:function(e,t,r){"use strict";var n={props:{title:{type:String}}},o=r(6),component=Object(o.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("ElAlert",{staticClass:"my-4 flex items-center",attrs:{title:e.title,type:"info","show-icon":"",closable:!1,size:"sm"}},[e._t("default")],2)],1)}),[],!1,null,null,null);t.a=component.exports}}]);